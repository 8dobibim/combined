# ğŸš€ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬ ê°€ì´ë“œ

> **â±ï¸ ì˜ˆìƒ ì†Œìš”ì‹œê°„**: 45-60ë¶„  
> **ğŸ’¡ ë‚œì´ë„**: ì¤‘ê¸‰  
> **ğŸ“‹ ëª©í‘œ**: EKS í´ëŸ¬ìŠ¤í„°ì— OpenWebUIì™€ LiteLLMì„ ë°°í¬í•©ë‹ˆë‹¤.

---

## ğŸ“‹ ë°°í¬ ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] ConfigMap ë° Secret ìƒì„±
- [ ] PostgreSQL ë°ì´í„°ë² ì´ìŠ¤ ë°°í¬
- [ ] LiteLLM ì„œë¹„ìŠ¤ ë°°í¬
- [ ] OpenWebUI ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬
- [ ] Ingress/LoadBalancer ì„¤ì •
- [ ] SSL ì¸ì¦ì„œ ì„¤ì •
- [ ] ëª¨ë‹ˆí„°ë§ ì„¤ì •

---

## ğŸ“ ë°°í¬ íŒŒì¼ êµ¬ì¡°

```
kubernetes/
â”œâ”€â”€ base/
â”‚   â”œâ”€â”€ configmaps/
â”‚   â”œâ”€â”€ secrets/
â”‚   â”œâ”€â”€ postgres/
â”‚   â”œâ”€â”€ litellm/
â”‚   â”œâ”€â”€ openwebui/
â”‚   â””â”€â”€ ingress/
â””â”€â”€ overlays/
    â”œâ”€â”€ dev/
    â””â”€â”€ prod/
```

---

## ğŸ—‚ï¸ 1ë‹¨ê³„: ConfigMap ë° Secret ìƒì„±

### ConfigMap ìƒì„±
```yaml
# kubernetes/base/configmaps/app-config.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
  namespace: openwebui
data:
  # PostgreSQL ì„¤ì •
  POSTGRES_HOST: "postgres-service.openwebui.svc.cluster.local"
  POSTGRES_PORT: "5432"
  POSTGRES_DB: "openwebui"
  
  # LiteLLM ì„¤ì •
  LITELLM_HOST: "litellm-service.litellm.svc.cluster.local"
  LITELLM_PORT: "4000"
  
  # OpenWebUI ì„¤ì •
  WEBUI_SECRET_KEY: "your-secret-key-here"
  WEBUI_JWT_SECRET_KEY: "your-jwt-secret-here"
  DEFAULT_LOCALE: "ko-KR"
  
  # ê¸°ë³¸ ì„¤ì •
  LOG_LEVEL: "INFO"
  ENVIRONMENT: "development"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: litellm-config
  namespace: litellm
data:
  config.yaml: |
    model_list:
      - model_name: gpt-3.5-turbo
        litellm_params:
          model: gpt-3.5-turbo
          api_key: os.environ/OPENAI_API_KEY
      - model_name: gpt-4
        litellm_params:
          model: gpt-4
          api_key: os.environ/OPENAI_API_KEY
      - model_name: claude-3-sonnet
        litellm_params:
          model: anthropic/claude-3-sonnet-20240229
          api_key: os.environ/ANTHROPIC_API_KEY
    
    general_settings:
      master_key: os.environ/LITELLM_MASTER_KEY
      database_url: os.environ/DATABASE_URL
```

### Secret ìƒì„±
```yaml
# kubernetes/base/secrets/app-secrets.yaml
apiVersion: v1
kind: Secret
metadata:
  name: app-secrets
  namespace: openwebui
type: Opaque
data:
  # Base64ë¡œ ì¸ì½”ë”©ëœ ê°’ë“¤
  POSTGRES_USER: b3BlbndlYnVp  # openwebui
  POSTGRES_PASSWORD: cGFzc3dvcmQxMjM=  # password123
---
apiVersion: v1
kind: Secret
metadata:
  name: api-keys
  namespace: litellm
type: Opaque
data:
  OPENAI_API_KEY: eW91ci1vcGVuYWktYXBpLWtleQ==  # your-openai-api-key
  ANTHROPIC_API_KEY: eW91ci1hbnRocm9waWMtYXBpLWtleQ==  # your-anthropic-api-key
  LITELLM_MASTER_KEY: bGl0ZWxsbS1tYXN0ZXIta2V5  # litellm-master-key
```

### ì‹¤ì œ Secret ìƒì„± (ëª…ë ¹ì–´)
```bash
# PostgreSQL ì¸ì¦ ì •ë³´
kubectl create secret generic app-secrets \
  --from-literal=POSTGRES_USER=openwebui \
  --from-literal=POSTGRES_PASSWORD=password123 \
  -n openwebui

# API í‚¤ë“¤
kubectl create secret generic api-keys \
  --from-literal=OPENAI_API_KEY=your-actual-openai-key \
  --from-literal=ANTHROPIC_API_KEY=your-actual-anthropic-key \
  --from-literal=LITELLM_MASTER_KEY=your-master-key \
  -n litellm
```

---

## ğŸ—ƒï¸ 2ë‹¨ê³„: PostgreSQL ë°ì´í„°ë² ì´ìŠ¤ ë°°í¬

### PVC ìƒì„±
```yaml
# kubernetes/base/postgres/pvc.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: postgres-pvc
  namespace: openwebui
spec:
  accessModes:
    - ReadWriteOnce
  storageClassName: gp3-encrypted
  resources:
    requests:
      storage: 10Gi
```

### PostgreSQL Deployment
```yaml
# kubernetes/base/postgres/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: postgres
  namespace: openwebui
spec:
  replicas: 1
  selector:
    matchLabels:
      app: postgres
  template:
    metadata:
      labels:
        app: postgres
    spec:
      containers:
      - name: postgres
        image: postgres:15
        ports:
        - containerPort: 5432
        env:
        - name: POSTGRES_DB
          valueFrom:
            configMapKeyRef:
              name: app-config
              key: POSTGRES_DB
        - name: POSTGRES_USER
          valueFrom:
            secretKeyRef:
              name: app-secrets
              key: POSTGRES_USER
        - name: POSTGRES_PASSWORD
          valueFrom:
            secretKeyRef:
              name: app-secrets
              key: POSTGRES_PASSWORD
        - name: PGDATA
          value: /var/lib/postgresql/data/pgdata
        volumeMounts:
        - name: postgres-storage
          mountPath: /var/lib/postgresql/data
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi"
            cpu: "500m"
      volumes:
      - name: postgres-storage
        persistentVolumeClaim:
          claimName: postgres-pvc
```

### PostgreSQL Service
```yaml
# kubernetes/base/postgres/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: postgres-service
  namespace: openwebui
spec:
  selector:
    app: postgres
  ports:
  - port: 5432
    targetPort: 5432
  type: ClusterIP
```

---

## ğŸ¤– 3ë‹¨ê³„: LiteLLM ì„œë¹„ìŠ¤ ë°°í¬

### LiteLLM Deployment
```yaml
# kubernetes/base/litellm/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: litellm
  namespace: litellm
spec:
  replicas: 2
  selector:
    matchLabels:
      app: litellm
  template:
    metadata:
      labels:
        app: litellm
    spec:
      containers:
      - name: litellm
        image: ghcr.io/berriai/litellm:main-latest
        ports:
        - containerPort: 4000
        env:
        - name: OPENAI_API_KEY
          valueFrom:
            secretKeyRef:
              name: api-keys
              key: OPENAI_API_KEY
        - name: ANTHROPIC_API_KEY
          valueFrom:
            secretKeyRef:
              name: api-keys
              key: ANTHROPIC_API_KEY
        - name: LITELLM_MASTER_KEY
          valueFrom:
            secretKeyRef:
              name: api-keys
              key: LITELLM_MASTER_KEY
        - name: DATABASE_URL
          value: "postgresql://$(POSTGRES_USER):$(POSTGRES_PASSWORD)@postgres-service.openwebui.svc.cluster.local:5432/litellm"
        envFrom:
        - secretRef:
            name: app-secrets
        volumeMounts:
        - name: config
          mountPath: /app/config.yaml
          subPath: config.yaml
        command: ["litellm", "--config", "/app/config.yaml", "--port", "4000", "--num_workers", "8"]
        resources:
          requests:
            memory: "512Mi"
            cpu: "250m"
          limits:
            memory: "1Gi"
            cpu: "500m"
        readinessProbe:
          httpGet:
            path: /health/readiness
            port: 4000
          initialDelaySeconds: 30
          periodSeconds: 10
        livenessProbe:
          httpGet:
            path: /health/liveliness
            port: 4000
          initialDelaySeconds: 60
          periodSeconds: 30
      volumes:
      - name: config
        configMap:
          name: litellm-config
```

### LiteLLM Service
```yaml
# kubernetes/base/litellm/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: litellm-service
  namespace: litellm
spec:
  selector:
    app: litellm
  ports:
  - port: 4000
    targetPort: 4000
  type: ClusterIP
```

---

## ğŸŒ 4ë‹¨ê³„: OpenWebUI ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬

### OpenWebUI Deployment
```yaml
# kubernetes/base/openwebui/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: openwebui
  namespace: openwebui
spec:
  replicas: 2
  selector:
    matchLabels:
      app: openwebui
  template:
    metadata:
      labels:
        app: openwebui
    spec:
      containers:
      - name: openwebui
        image: ghcr.io/open-webui/open-webui:main
        ports:
        - containerPort: 8080
        env:
        - name: OLLAMA_BASE_URL
          value: "http://litellm-service.litellm.svc.cluster.local:4000"
        - name: WEBUI_SECRET_KEY
          valueFrom:
            configMapKeyRef:
              name: app-config
              key: WEBUI_SECRET_KEY
        - name: DATABASE_URL
          value: "postgresql://$(POSTGRES_USER):$(POSTGRES_PASSWORD)@postgres-service:5432/openwebui"
        - name: DEFAULT_LOCALE
          valueFrom:
            configMapKeyRef:
              name: app-config
              key: DEFAULT_LOCALE
        envFrom:
        - secretRef:
            name: app-secrets
        - configMapRef:
            name: app-config
        volumeMounts:
        - name: data
          mountPath: /app/backend/data
        resources:
          requests:
            memory: "512Mi"
            cpu: "250m"
          limits:
            memory: "1Gi"
            cpu: "500m"
        readinessProbe:
          httpGet:
            path: /health
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 10
        livenessProbe:
          httpGet:
            path: /health
            port: 8080
          initialDelaySeconds: 60
          periodSeconds: 30
      volumes:
      - name: data
        persistentVolumeClaim:
          claimName: openwebui-pvc
```

### OpenWebUI PVC
```yaml
# kubernetes/base/openwebui/pvc.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: openwebui-pvc
  namespace: openwebui
spec:
  accessModes:
    - ReadWriteOnce
  storageClassName: gp3-encrypted
  resources:
    requests:
      storage: 5Gi
```

### OpenWebUI Service
```yaml
# kubernetes/base/openwebui/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: openwebui-service
  namespace: openwebui
spec:
  selector:
    app: openwebui
  ports:
  - port: 8080
    targetPort: 8080
  type: ClusterIP
```

---

## ğŸŒ 5ë‹¨ê³„: Ingress ë° LoadBalancer ì„¤ì •

### Application Load Balancer (ALB) ì„¤ì •
```yaml
# kubernetes/base/ingress/ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: openwebui-ingress
  namespace: openwebui
  annotations:
    # ALB ì„¤ì •
    kubernetes.io/ingress.class: alb
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
    
    # SSL ì„¤ì •
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS": 443}]'
    alb.ingress.kubernetes.io/ssl-redirect: '443'
    alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:ap-northeast-2:ACCOUNT_ID:certificate/CERT_ID
    
    # í—¬ìŠ¤ì²´í¬ ì„¤ì •
    alb.ingress.kubernetes.io/healthcheck-path: /health
    alb.ingress.kubernetes.io/healthcheck-interval-seconds: '30'
    alb.ingress.kubernetes.io/healthcheck-timeout-seconds: '5'
    alb.ingress.kubernetes.io/healthy-threshold-count: '2'
    alb.ingress.kubernetes.io/unhealthy-threshold-count: '3'
    
    # ê¸°íƒ€ ì„¤ì •
    alb.ingress.kubernetes.io/load-balancer-name: openwebui-alb
    alb.ingress.kubernetes.io/tags: Environment=dev,Project=openwebui
spec:
  rules:
  - host: openwebui.yourdomain.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: openwebui-service
            port:
              number: 8080
```

### LoadBalancer Service (ëŒ€ì•ˆ)
```yaml
# kubernetes/base/ingress/loadbalancer.yaml
apiVersion: v1
kind: Service
metadata:
  name: openwebui-loadbalancer
  namespace: openwebui
  annotations:
    service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
    service.beta.kubernetes.io/aws-load-balancer-scheme: "internet-facing"
    service.beta.kubernetes.io/aws-load-balancer-name: "openwebui-nlb"
spec:
  type: LoadBalancer
  selector:
    app: openwebui
  ports:
  - port: 80
    targetPort: 8080
    protocol: TCP
```

---

## ğŸ“Š 6ë‹¨ê³„: ëª¨ë‹ˆí„°ë§ ì„¤ì •

### Prometheus ServiceMonitor
```yaml
# kubernetes/base/monitoring/servicemonitor.yaml
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: openwebui-monitor
  namespace: monitoring
spec:
  selector:
    matchLabels:
      app: openwebui
  endpoints:
  - port: http
    path: /metrics
    interval: 30s
---
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: litellm-monitor
  namespace: monitoring
spec:
  selector:
    matchLabels:
      app: litellm
  endpoints:
  - port: http
    path: /metrics
    interval: 30s
```

---

## ğŸš€ 7ë‹¨ê³„: ë°°í¬ ì‹¤í–‰

### ë°°í¬ ìˆœì„œ
```bash
# 1. ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ìƒì„± (ì´ë¯¸ ì™„ë£Œë¨)
kubectl get namespaces

# 2. ConfigMap ë° Secret ì ìš©
kubectl apply -f kubernetes/base/configmaps/
kubectl apply -f kubernetes/base/secrets/

# 3. PostgreSQL ë°°í¬
kubectl apply -f kubernetes/base/postgres/

# PostgreSQL ì¤€ë¹„ ì™„ë£Œ ëŒ€ê¸°
kubectl wait --for=condition=ready pod -l app=postgres -n openwebui --timeout=300s

# 4. LiteLLM ë°°í¬
kubectl apply -f kubernetes/base/litellm/

# LiteLLM ì¤€ë¹„ ì™„ë£Œ ëŒ€ê¸°
kubectl wait --for=condition=ready pod -l app=litellm -n litellm --timeout=300s

# 5. OpenWebUI ë°°í¬
kubectl apply -f kubernetes/base/openwebui/

# OpenWebUI ì¤€ë¹„ ì™„ë£Œ ëŒ€ê¸°
kubectl wait --for=condition=ready pod -l app=openwebui -n openwebui --timeout=300s

# 6. Ingress ì„¤ì •
kubectl apply -f kubernetes/base/ingress/

# 7. ëª¨ë‹ˆí„°ë§ ì„¤ì • (ì„ íƒì‚¬í•­)
kubectl apply -f kubernetes/base/monitoring/
```

### ë°°í¬ ìŠ¤í¬ë¦½íŠ¸
```bash
#!/bin/bash
# deploy.sh

set -e

echo "ğŸš€ OpenWebUI ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬ ì‹œì‘..."

# í™˜ê²½ í™•ì¸
if ! kubectl get nodes > /dev/null 2>&1; then
    echo "âŒ kubectlì´ í´ëŸ¬ìŠ¤í„°ì— ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
    exit 1
fi

echo "ğŸ“ 1. ConfigMap ë° Secret ì ìš©..."
kubectl apply -f kubernetes/base/configmaps/
kubectl apply -f kubernetes/base/secrets/

echo "ğŸ—ƒï¸ 2. PostgreSQL ë°°í¬..."
kubectl apply -f kubernetes/base/postgres/
echo "â³ PostgreSQL ì¤€ë¹„ ëŒ€ê¸°..."
kubectl wait --for=condition=ready pod -l app=postgres -n openwebui --timeout=300s

echo "ğŸ¤– 3. LiteLLM ë°°í¬..."
kubectl apply -f kubernetes/base/litellm/
echo "â³ LiteLLM ì¤€ë¹„ ëŒ€ê¸°..."
kubectl wait --for=condition=ready pod -l app=litellm -n litellm --timeout=300s

echo "ğŸŒ 4. OpenWebUI ë°°í¬..."
kubectl apply -f kubernetes/base/openwebui/
echo "â³ OpenWebUI ì¤€ë¹„ ëŒ€ê¸°..."
kubectl wait --for=condition=ready pod -l app=openwebui -n openwebui --timeout=300s

echo "ğŸŒ 5. Ingress ì„¤ì •..."
kubectl apply -f kubernetes/base/ingress/

echo "ğŸ“Š 6. ëª¨ë‹ˆí„°ë§ ì„¤ì •..."
kubectl apply -f kubernetes/base/monitoring/ || echo "âš ï¸ ëª¨ë‹ˆí„°ë§ ì„¤ì • ì‹¤íŒ¨ (ì„ íƒì‚¬í•­)"

echo "âœ… ë°°í¬ ì™„ë£Œ!"
echo "ğŸ”— LoadBalancer URL í™•ì¸:"
kubectl get ingress -n openwebui
kubectl get svc -n openwebui

echo "ğŸ“‹ íŒŒë“œ ìƒíƒœ í™•ì¸:"
kubectl get pods -n openwebui
kubectl get pods -n litellm
```

```bash
chmod +x deploy.sh
./deploy.sh
```

---

## ğŸ” ìƒíƒœ í™•ì¸

### ë°°í¬ ìƒíƒœ í™•ì¸
```bash
# ì „ì²´ íŒŒë“œ ìƒíƒœ
kubectl get pods -A

# ì„œë¹„ìŠ¤ ìƒíƒœ
kubectl get svc -A

# Ingress ìƒíƒœ
kubectl get ingress -A

# ë¡œê·¸ í™•ì¸
kubectl logs -f deployment/openwebui -n openwebui
kubectl logs -f deployment/litellm -n litellm
kubectl logs -f deployment/postgres -n openwebui
```

### ì„œë¹„ìŠ¤ ì ‘ê·¼ í…ŒìŠ¤íŠ¸
```bash
# í¬íŠ¸ í¬ì›Œë”©ìœ¼ë¡œ ë¡œì»¬ í…ŒìŠ¤íŠ¸
kubectl port-forward svc/openwebui-service 8080:8080 -n openwebui

# ë¸Œë¼ìš°ì €ì—ì„œ http://localhost:8080 ì ‘ì†
```

---

## ğŸ”§ ì„¤ì • ì—…ë°ì´íŠ¸

### ConfigMap ì—…ë°ì´íŠ¸
```bash
# ConfigMap ìˆ˜ì • í›„ íŒŒë“œ ì¬ì‹œì‘
kubectl apply -f kubernetes/base/configmaps/
kubectl rollout restart deployment/openwebui -n openwebui
kubectl rollout restart deployment/litellm -n litellm
```

### Secret ì—…ë°ì´íŠ¸
```bash
# ìƒˆ API í‚¤ ì¶”ê°€
kubectl create secret generic api-keys \
  --from-literal=OPENAI_API_KEY=new-key \
  --from-literal=ANTHROPIC_API_KEY=new-key \
  --dry-run=client -o yaml | kubectl apply -f -

kubectl rollout restart deployment/litellm -n litellm
```

---

## ğŸ“ˆ ìŠ¤ì¼€ì¼ë§

### ìˆ˜ë™ ìŠ¤ì¼€ì¼ë§
```bash
# OpenWebUI íŒŒë“œ ê°œìˆ˜ ì¡°ì •
kubectl scale deployment openwebui --replicas=3 -n openwebui

# LiteLLM íŒŒë“œ ê°œìˆ˜ ì¡°ì •
kubectl scale deployment litellm --replicas=4 -n litellm
```

### HPA (Horizontal Pod Autoscaler) ì„¤ì •
```yaml
# kubernetes/base/openwebui/hpa.yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: openwebui-hpa
  namespace: openwebui
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: openwebui
  minReplicas: 2
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80
```

---

## â­ï¸ ë‹¤ìŒ ë‹¨ê³„

ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬ê°€ ì™„ë£Œë˜ì—ˆë‹¤ë©´:
- **[06-verification.md]** - ë°°í¬ ê²€ì¦ ë° í…ŒìŠ¤íŠ¸