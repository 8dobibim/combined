# ğŸš€ Terraformì„ ì´ìš©í•œ AWS í™˜ê²½ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬ ê°€ì´ë“œ

> **â±ï¸ ì˜ˆìƒ ì†Œìš”ì‹œê°„**: 30-45ë¶„  
> **ğŸ’° ì˜ˆìƒ ë¹„ìš©**: ì‹œê°„ë‹¹ ì•½ $0.5-1.0 (t3.medium ì¸ìŠ¤í„´ìŠ¤ 2ê°œ ê¸°ì¤€)  
> **ğŸ“‹ ëª©í‘œ**: AWSì— Kubernetes í´ëŸ¬ìŠ¤í„°ë¥¼ ë§Œë“¤ê³  ì„œë¹„ìŠ¤ë¥¼ ë°°í¬í•©ë‹ˆë‹¤.

---

## ğŸ“‹ ì‹œì‘í•˜ê¸° ì „ì— ì¤€ë¹„í•  ê²ƒë“¤

### 1. AWS ê³„ì •
- AWS ê³„ì •ì´ ì—†ë‹¤ë©´: https://aws.amazon.com ì—ì„œ ê°€ì…
- ì‹ ìš©ì¹´ë“œ í•„ìš” (ê³¼ê¸ˆ ì£¼ì˜!)

### 2. í•„ìš”í•œ í”„ë¡œê·¸ë¨ ì„¤ì¹˜
ì•„ë˜ í”„ë¡œê·¸ë¨ë“¤ì„ ìˆœì„œëŒ€ë¡œ ì„¤ì¹˜í•˜ì„¸ìš”:

#### Windows ì‚¬ìš©ì
```powershell
# 1. Chocolatey ì„¤ì¹˜ (Windows íŒ¨í‚¤ì§€ ê´€ë¦¬ì)
Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))

# 2. í•„ìš”í•œ í”„ë¡œê·¸ë¨ ì„¤ì¹˜
choco install terraform aws-cli kubectl -y

# 3. ì„¤ì¹˜ í™•ì¸
terraform --version
aws --version
kubectl version --client
```

#### Mac ì‚¬ìš©ì
```bash
# 1. Homebrew ì„¤ì¹˜ (Mac íŒ¨í‚¤ì§€ ê´€ë¦¬ì)
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# 2. í•„ìš”í•œ í”„ë¡œê·¸ë¨ ì„¤ì¹˜
brew install terraform awscli kubectl

# 3. ì„¤ì¹˜ í™•ì¸
terraform --version
aws --version
kubectl version --client
```

---

## ğŸ” STEP 1: AWS ì ‘ì† ì„¤ì •

### 1.1 AWS Access Key ìƒì„±
1. AWS ì½˜ì†” ë¡œê·¸ì¸: https://console.aws.amazon.com
2. ìš°ì¸¡ ìƒë‹¨ ê³„ì •ëª… í´ë¦­ â†’ "Security credentials" í´ë¦­
3. "Access keys" ì„¹ì…˜ì—ì„œ "Create access key" í´ë¦­
4. "Command Line Interface (CLI)" ì„ íƒ â†’ Next
5. Access Key IDì™€ Secret Access Keyë¥¼ ì•ˆì „í•œ ê³³ì— ë³µì‚¬í•´ë‘ê¸°

### 1.2 AWS CLI ì„¤ì •
í„°ë¯¸ë„/ëª…ë ¹ í”„ë¡¬í”„íŠ¸ì—ì„œ:
```bash
aws configure --profile llm
```
ë‹¤ìŒ ì •ë³´ ì…ë ¥:
- AWS Access Key ID: [ìœ„ì—ì„œ ë³µì‚¬í•œ Access Key ID]
- AWS Secret Access Key: [ìœ„ì—ì„œ ë³µì‚¬í•œ Secret Key]
- Default region name: `ap-northeast-2` (ì„œìš¸ ë¦¬ì „)
- Default output format: `json`

---

## ğŸ“ STEP 2: í”„ë¡œì íŠ¸ íŒŒì¼ ì¤€ë¹„

### 2.1 GitHub ë ˆí¬ì§€í† ë¦¬ í´ë¡ 
```bash
# í™ˆ ë””ë ‰í† ë¦¬ë¡œ ì´ë™
cd ~

# GitHub ë ˆí¬ì§€í† ë¦¬ í´ë¡ 
git clone https://github.com/8dobibim/combined.git

# Terraform í´ë”ë¡œ ì´ë™
cd combined/8dobibim_back/terraform-related/AWS_terraform_grafana
```

### 2.2 AWS Access Key ìƒì„±
í´ë¡ í•œ ë ˆí¬ì§€í† ë¦¬ì—ëŠ” ì´ë¯¸ í•„ìš”í•œ íŒŒì¼ë“¤ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

1. `main.tf` - ë©”ì¸ ì¸í”„ë¼ ì„¤ì •
2. `variables.tf` - ë³€ìˆ˜ ì •ì˜
3. `versions.tf` - Terraform ë²„ì „ ì„¤ì •  
4. `tfvars.example` - ì„¤ì •ê°’ ì˜ˆì‹œ íŒŒì¼

íŒŒì¼ë“¤ì´ ì œëŒ€ë¡œ ìˆëŠ”ì§€ í™•ì¸:
```bash
# íŒŒì¼ ëª©ë¡ í™•ì¸
ls -la

# ì¶œë ¥ ì˜ˆì‹œ:
# main.tf
# variables.tf
# versions.tf
# tfvars.example
```

### 2.3 terraform.tfvars íŒŒì¼ ìƒì„± ë° ìˆ˜ì •

```bash
# tfvars.example íŒŒì¼ì„ ë³µì‚¬í•˜ì—¬ terraform.tfvars ìƒì„±
cp tfvars.example terraform.tfvars

# í¸ì§‘ê¸°ë¡œ ì—´ê¸°
# Windows: notepad terraform.tfvars
# Mac/Linux: nano terraform.tfvars
```

**ì¤‘ìš”! ë‹¤ìŒ ê°’ë“¤ì„ ì‹¤ì œ ê°’ìœ¼ë¡œ ë³€ê²½í•˜ì„¸ìš”:**

```hcl
# terraform.tfvars ìˆ˜ì • ì˜ˆì‹œ

# 1. VPCì™€ ì„œë¸Œë„·ì€ ìƒˆë¡œ ìƒì„±ë˜ë¯€ë¡œ ìˆ˜ì • ë¶ˆí•„ìš”
vpc_id = "vpc-0822943b0a085c50a"  # ê·¸ëŒ€ë¡œ ë‘¬ë„ ë¨ (main.tfì—ì„œ ìƒˆë¡œ ìƒì„±)
private_subnet_ids = ["subnet-0123683b550a9a14b", "subnet-0d49ef817f70df74b"]  # ê·¸ëŒ€ë¡œ ë‘¬ë„ ë¨

# 2. API í‚¤ë“¤ - ë°˜ë“œì‹œ ì‹¤ì œ ê°’ìœ¼ë¡œ ë³€ê²½!
GEMINI_API_KEY = "ì—¬ê¸°ì—-ì‹¤ì œ-Gemini-API-í‚¤"
AZURE_API_KEY = "ì—¬ê¸°ì—-ì‹¤ì œ-Azure-API-í‚¤"
AZURE_API_BASE = "https://your-resource.openai.azure.com/"  # Azure OpenAI ì—”ë“œí¬ì¸íŠ¸
AZURE_API_VERSION = "2023-07-01-preview"

# 3. ë³´ì•ˆ í‚¤ - ì›í•˜ëŠ” ê°’ìœ¼ë¡œ ë³€ê²½
litellm_master_key = "sk-my-secure-master-key-12345"
litellm_salt_key = "my-secure-salt-key-67890"

# 4. PostgreSQL ì„¤ì • - ì›í•˜ëŠ” ê°’ìœ¼ë¡œ ë³€ê²½
postgres_user = "dbadmin"
postgres_password = "SuperSecurePass123!"
postgres_db = "openwebui_db"

# 5. database_urlì€ ìœ„ ê°’ë“¤ë¡œ ìë™ ìƒì„±
database_url = "postgresql://dbadmin:SuperSecurePass123!@postgres-service:5432/openwebui_db"
```

### 2.4 API í‚¤ ì–»ëŠ” ë°©ë²•

#### Gemini API Key
1. https://makersuite.google.com/app/apikey ì ‘ì†
2. Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸
3. "Create API Key" í´ë¦­
4. ìƒì„±ëœ í‚¤ ë³µì‚¬

#### Azure OpenAI Key (ì„ íƒì‚¬í•­)
1. https://portal.azure.com ì ‘ì†
2. Azure OpenAI ë¦¬ì†ŒìŠ¤ ìƒì„± í•„ìš”
3. ë¦¬ì†ŒìŠ¤ â†’ Keys and Endpointì—ì„œ í‚¤ í™•ì¸

**ì°¸ê³ **: API í‚¤ê°€ ì—†ì–´ë„ ë°°í¬ëŠ” ê°€ëŠ¥í•˜ì§€ë§Œ, AI ëª¨ë¸ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

---

## ğŸ—ï¸ STEP 3: ì¸í”„ë¼ ë°°í¬

### 3.1 Terraform ì´ˆê¸°í™”
```bash
terraform init
```

ì„±ê³µ ë©”ì‹œì§€ê°€ ë‚˜íƒ€ë‚˜ì•¼ í•©ë‹ˆë‹¤:
```
Terraform has been successfully initialized!
```

### 3.2 ë°°í¬ ê³„íš í™•ì¸
```bash
terraform plan
```

ë§Œë“¤ì–´ì§ˆ ë¦¬ì†ŒìŠ¤ë“¤ì„ í™•ì¸í•©ë‹ˆë‹¤. ì•½ 30-40ê°œì˜ ë¦¬ì†ŒìŠ¤ê°€ ìƒì„±ë©ë‹ˆë‹¤.

### 3.3 ì‹¤ì œ ë°°í¬ ì‹¤í–‰
```bash
terraform apply
```

ë‹¤ìŒê³¼ ê°™ì´ ë¬¼ì–´ë³´ë©´ `yes` ì…ë ¥:
```
Do you want to perform these actions?
  Terraform will perform the actions described above.
  Only 'yes' will be accepted to approve.

  Enter a value: yes
```

**â³ ëŒ€ê¸°**: 15-20ë¶„ ì •ë„ ì†Œìš”ë©ë‹ˆë‹¤. ì»¤í”¼ í•œì” í•˜ê³  ì˜¤ì„¸ìš”! â˜•

---

## ğŸ” STEP 4: ë°°í¬ í™•ì¸

### 4.1 EKS í´ëŸ¬ìŠ¤í„° ì ‘ì† ì„¤ì •
```bash
# kubeconfig ì—…ë°ì´íŠ¸
aws eks update-kubeconfig --name llm-project-eks --region ap-northeast-2 --profile llm

# ì—°ê²° í™•ì¸
kubectl get nodes
```

ë…¸ë“œ ëª©ë¡ì´ ë³´ì´ë©´ ì„±ê³µ!

### 4.2 ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
```bash
# ëª¨ë“  Pod í™•ì¸
kubectl get pods --all-namespaces

# ì„œë¹„ìŠ¤ í™•ì¸
kubectl get svc --all-namespaces
```

### 4.3 ì™¸ë¶€ ì ‘ì† URL í™•ì¸
```bash
# OpenWebUI ì ‘ì† ì£¼ì†Œ í™•ì¸
kubectl get svc openwebui-service -n default
```

`EXTERNAL-IP` ì—´ì— í‘œì‹œëœ ì£¼ì†Œë¥¼ ë³µì‚¬í•©ë‹ˆë‹¤.
ì˜ˆ: `a1234567890-123456789.ap-northeast-2.elb.amazonaws.com`

---

## ğŸŒ STEP 5: ì„œë¹„ìŠ¤ ì ‘ì†

### 5.1 ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ì†
1. ë¸Œë¼ìš°ì € ì—´ê¸°
2. ì£¼ì†Œì°½ì— ì…ë ¥: `http://[EXTERNAL-IP]:3000`
3. OpenWebUI í™”ë©´ì´ ë‚˜íƒ€ë‚˜ë©´ ì„±ê³µ!

### 5.2 ì´ˆê¸° ì„¤ì •
1. ì²« ì ‘ì† ì‹œ "Sign up" í´ë¦­
2. ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¡œ ê³„ì • ìƒì„±
3. ë¡œê·¸ì¸ í›„ AI ëª¨ë¸ê³¼ ëŒ€í™” ì‹œì‘

---

## ğŸ’° STEP 6: ë¹„ìš© ê´€ë¦¬ (ì¤‘ìš”!)

### 6.1 ë¦¬ì†ŒìŠ¤ ì‚­ì œ (ì‚¬ìš© í›„ ë°˜ë“œì‹œ ì‹¤í–‰!)
```bash
# ëª¨ë“  ë¦¬ì†ŒìŠ¤ ì‚­ì œ
terraform destroy

# í™•ì¸ ë©”ì‹œì§€ì— yes ì…ë ¥
```

### 6.2 ë¹„ìš© í™•ì¸
- AWS Console â†’ Billing â†’ Cost Explorerì—ì„œ í™•ì¸
- ì£¼ìš” ë¹„ìš© ìš”ì†Œ:
  - EC2 ì¸ìŠ¤í„´ìŠ¤ (t3.medium x 2)
  - EBS ë³¼ë¥¨
  - Load Balancer
  - ë°ì´í„° ì „ì†¡

---

## ğŸ”§ ë¬¸ì œ í•´ê²°

### "kubectl: command not found" ì˜¤ë¥˜
```bash
# Windows
choco install kubernetes-cli

# Mac
brew install kubectl
```

### "Error: error configuring Terraform AWS Provider" ì˜¤ë¥˜
```bash
# AWS ìê²© ì¦ëª… ì¬ì„¤ì •
aws configure --profile llm
```

### Podê°€ ê³„ì† Pending ìƒíƒœì¸ ê²½ìš°
```bash
# Pod ìƒíƒœ ìƒì„¸ í™•ì¸
kubectl describe pod [POD_NAME] -n default

# ë…¸ë“œ ìƒíƒœ í™•ì¸
kubectl describe nodes
```

### LoadBalancerê°€ ìƒì„±ë˜ì§€ ì•ŠëŠ” ê²½ìš°
1. AWS ì½˜ì†”ì—ì„œ EC2 â†’ Load Balancers í™•ì¸
2. VPCì™€ ì„œë¸Œë„· ì„¤ì • í™•ì¸
3. ë³´ì•ˆ ê·¸ë£¹ ì„¤ì • í™•ì¸

---

## ğŸ“ ì¶”ê°€ ëª…ë ¹ì–´ ëª¨ìŒ

### ë¡œê·¸ í™•ì¸
```bash
# LiteLLM ë¡œê·¸
kubectl logs -l app=litellm -n default

# OpenWebUI ë¡œê·¸  
kubectl logs -l app=openwebui -n default

# PostgreSQL ë¡œê·¸
kubectl logs -l app=postgres -n default
```

### ì¬ì‹œì‘
```bash
# íŠ¹ì • ì„œë¹„ìŠ¤ ì¬ì‹œì‘
kubectl rollout restart deployment/openwebui -n default
kubectl rollout restart deployment/litellm -n default
```

### ìŠ¤ì¼€ì¼ ì¡°ì •
```bash
# Pod ê°œìˆ˜ ëŠ˜ë¦¬ê¸°
kubectl scale deployment/openwebui --replicas=3 -n default
```

---

## ğŸ¯ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] AWS ê³„ì • ìƒì„± ì™„ë£Œ
- [ ] AWS CLI ì„¤ì • ì™„ë£Œ
- [ ] Terraform ì„¤ì¹˜ ì™„ë£Œ
- [ ] í”„ë¡œì íŠ¸ íŒŒì¼ ìƒì„± ì™„ë£Œ
- [ ] terraform.tfvars ìˆ˜ì • ì™„ë£Œ
- [ ] terraform init ì‹¤í–‰ ì™„ë£Œ
- [ ] terraform apply ì‹¤í–‰ ì™„ë£Œ
- [ ] kubectl ì—°ê²° í™•ì¸ ì™„ë£Œ
- [ ] ì›¹ ë¸Œë¼ìš°ì €ë¡œ ì ‘ì† ì„±ê³µ
- [ ] **terraform destroy ì‹¤í–‰ (ì‚¬ìš© í›„ í•„ìˆ˜!)**

---

## ğŸ†˜ ë„ì›€ì´ í•„ìš”í•˜ë©´

1. ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ì •í™•íˆ ë³µì‚¬
2. ì–´ëŠ ë‹¨ê³„ì—ì„œ ë¬¸ì œê°€ ë°œìƒí–ˆëŠ”ì§€ í™•ì¸
3. AWS ì½˜ì†”ì—ì„œ ë¦¬ì†ŒìŠ¤ ìƒì„± ìƒíƒœ í™•ì¸
4. CloudFormation ìŠ¤íƒ í™•ì¸ (ì‹¤íŒ¨í•œ ë¦¬ì†ŒìŠ¤ í™•ì¸)

**ê¸°ì–µí•˜ì„¸ìš”**: 
- ğŸ”´ ì‚¬ìš© í›„ì—ëŠ” ë°˜ë“œì‹œ `terraform destroy`ë¥¼ ì‹¤í–‰í•˜ì—¬ ë¹„ìš© ë°œìƒì„ ë§‰ìœ¼ì„¸ìš”!
- ğŸŸ¡ API í‚¤ëŠ” ì ˆëŒ€ë¡œ GitHub ë“±ì— ê³µê°œí•˜ì§€ ë§ˆì„¸ìš”!
- ğŸŸ¢ ë¬¸ì œê°€ ìƒê¸°ë©´ ë‹¹í™©í•˜ì§€ ë§ê³  ì°¨ê·¼ì°¨ê·¼ ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”!
