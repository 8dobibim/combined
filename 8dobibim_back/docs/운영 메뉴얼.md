# ğŸ› ï¸ OpenWebUI ìš´ì˜ ë§¤ë‰´ì–¼

> **ğŸ‘¥ ëŒ€ìƒ**: DevOps ì—”ì§€ë‹ˆì–´, SRE, ì‹œìŠ¤í…œ ê´€ë¦¬ì  
> **ğŸ“… ì—…ë°ì´íŠ¸**: ì •ê¸°ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ í•„ìš”  
> **ğŸš¨ ë¹„ìƒ ì—°ë½ì²˜**: [íŒ€ ì—°ë½ì²˜ ì •ë³´]

---

## ğŸ“‹ ì¼ì¼ ìš´ì˜ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë§¤ì¼ í™•ì¸ í•­ëª©
```bash
#!/bin/bash
# daily-check.sh

echo "ğŸ“… $(date '+%Y-%m-%d %H:%M:%S') - ì¼ì¼ ìš´ì˜ ì²´í¬ ì‹œì‘"

# 1. í´ëŸ¬ìŠ¤í„° ìƒíƒœ
kubectl get nodes
kubectl get pods -A | grep -v Running

# 2. ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒíƒœ
kubectl get pods -n openwebui -n litellm

# 3. ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰
kubectl top nodes
kubectl top pods -A

# 4. ìµœê·¼ ì—ëŸ¬ ë¡œê·¸ (ìµœê·¼ 1ì‹œê°„)
kubectl logs --since=1h -n openwebui -l app=openwebui | grep -i error | tail -10

# 5. ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰
kubectl get pvc -A

echo "âœ… ì¼ì¼ ì²´í¬ ì™„ë£Œ"
```

### ì£¼ê°„ í™•ì¸ í•­ëª©
- [ ] ë°±ì—… ìƒíƒœ í™•ì¸
- [ ] ë³´ì•ˆ íŒ¨ì¹˜ ê²€í† 
- [ ] ë¹„ìš© ì‚¬ìš©ëŸ‰ í™•ì¸
- [ ] ì„±ëŠ¥ ë©”íŠ¸ë¦­ ê²€í† 
- [ ] ë¡œê·¸ ì •ë¦¬

---

## ğŸ” ëª¨ë‹ˆí„°ë§ ë° ì•ŒëŒ

### í•µì‹¬ ë©”íŠ¸ë¦­
```yaml
# prometheus-alerts.yml
groups:
- name: openwebui.rules
  rules:
  # íŒŒë“œ ìƒíƒœ ì•ŒëŒ
  - alert: PodCrashLooping
    expr: rate(kube_pod_container_status_restarts_total[5m]) > 0
    for: 5m
    annotations:
      summary: "Pod {{ $labels.pod }} is crash looping"
  
  # ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ ì•ŒëŒ
  - alert: HighCPUUsage
    expr: (cpu_usage_rate > 80)
    for: 10m
    annotations:
      summary: "High CPU usage: {{ $value }}%"
  
  # ì‘ë‹µ ì‹œê°„ ì•ŒëŒ
  - alert: HighResponseTime
    expr: http_request_duration_seconds > 2
    for: 5m
    annotations:
      summary: "High response time: {{ $value }}s"
```

### ë¡œê·¸ ëª¨ë‹ˆí„°ë§
```bash
# ì‹¤ì‹œê°„ ë¡œê·¸ ëª¨ë‹ˆí„°ë§
kubectl logs -f deployment/openwebui -n openwebui

# ì—ëŸ¬ ë¡œê·¸ ê²€ìƒ‰
kubectl logs deployment/openwebui -n openwebui | grep -E "(ERROR|FATAL|CRITICAL)"

# íŠ¹ì • ì‹œê°„ëŒ€ ë¡œê·¸
kubectl logs --since=2h --until=1h deployment/openwebui -n openwebui
```

---

## ğŸ“Š ì„±ëŠ¥ ê´€ë¦¬

### ìŠ¤ì¼€ì¼ë§ ê´€ë¦¬
```bash
# ìˆ˜ë™ ìŠ¤ì¼€ì¼ë§
kubectl scale deployment openwebui --replicas=5 -n openwebui
kubectl scale deployment litellm --replicas=3 -n litellm

# HPA ìƒíƒœ í™•ì¸
kubectl get hpa -A

# ìŠ¤ì¼€ì¼ë§ ì´ë²¤íŠ¸ í™•ì¸
kubectl describe hpa openwebui-hpa -n openwebui
```

### ë¦¬ì†ŒìŠ¤ ìµœì í™”
```yaml
# ë¦¬ì†ŒìŠ¤ ìš”ì²­ëŸ‰ ì¡°ì • ì˜ˆì‹œ
resources:
  requests:
    memory: "512Mi"    # ì‹¤ì œ ì‚¬ìš©ëŸ‰ ê¸°ë°˜ ì¡°ì •
    cpu: "250m"
  limits:
    memory: "1Gi"      # OOM ë°©ì§€
    cpu: "500m"        # CPU ìŠ¤ë¡œí‹€ë§ ë°©ì§€
```

### ë°ì´í„°ë² ì´ìŠ¤ ì„±ëŠ¥
```bash
# PostgreSQL ì—°ê²° ìˆ˜ í™•ì¸
kubectl exec deployment/postgres -n openwebui -- \
  psql -U openwebui -d openwebui -c \
  "SELECT count(*) FROM pg_stat_activity WHERE state = 'active';"

# ìŠ¬ë¡œìš° ì¿¼ë¦¬ í™•ì¸
kubectl exec deployment/postgres -n openwebui -- \
  psql -U openwebui -d openwebui -c \
  "SELECT query, mean_exec_time FROM pg_stat_statements ORDER BY mean_exec_time DESC LIMIT 10;"

# ë°ì´í„°ë² ì´ìŠ¤ í¬ê¸° í™•ì¸
kubectl exec deployment/postgres -n openwebui -- \
  psql -U openwebui -d openwebui -c \
  "SELECT pg_size_pretty(pg_database_size('openwebui'));"
```

---

## ğŸ”„ ë°±ì—… ë° ë³µì›

### ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—…
```bash
#!/bin/bash
# backup-database.sh

BACKUP_DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_FILE="openwebui_backup_${BACKUP_DATE}.sql"

# PostgreSQL ë°±ì—…
kubectl exec deployment/postgres -n openwebui -- \
  pg_dump -U openwebui openwebui > $BACKUP_FILE

# S3ì— ì—…ë¡œë“œ
aws s3 cp $BACKUP_FILE s3://openwebui-backups/database/

# ë¡œì»¬ íŒŒì¼ ì •ë¦¬ (7ì¼ ì´ìƒ ëœ íŒŒì¼)
find . -name "openwebui_backup_*.sql" -mtime +7 -delete

echo "âœ… ë°±ì—… ì™„ë£Œ: $BACKUP_FILE"
```

### ë°ì´í„°ë² ì´ìŠ¤ ë³µì›
```bash
#!/bin/bash
# restore-database.sh

BACKUP_FILE=$1

if [ -z "$BACKUP_FILE" ]; then
  echo "ì‚¬ìš©ë²•: $0 <backup_file>"
  exit 1
fi

# S3ì—ì„œ ë°±ì—… íŒŒì¼ ë‹¤ìš´ë¡œë“œ
aws s3 cp s3://openwebui-backups/database/$BACKUP_FILE .

# ì• í”Œë¦¬ì¼€ì´ì…˜ ì¤‘ì§€
kubectl scale deployment openwebui --replicas=0 -n openwebui
kubectl scale deployment litellm --replicas=0 -n litellm

# ë°ì´í„°ë² ì´ìŠ¤ ë³µì›
kubectl exec -i deployment/postgres -n openwebui -- \
  psql -U openwebui openwebui < $BACKUP_FILE

# ì• í”Œë¦¬ì¼€ì´ì…˜ ì¬ì‹œì‘
kubectl scale deployment openwebui --replicas=2 -n openwebui
kubectl scale deployment litellm --replicas=2 -n litellm

echo "âœ… ë³µì› ì™„ë£Œ"
```

### ì„¤ì • íŒŒì¼ ë°±ì—…
```bash
# ConfigMap ë°±ì—…
kubectl get configmap -n openwebui -o yaml > configmaps-backup.yaml
kubectl get configmap -n litellm -o yaml >> configmaps-backup.yaml

# Secret ë°±ì—… (ì•”í˜¸í™”ëœ í˜•íƒœ)
kubectl get secret -n openwebui -o yaml > secrets-backup.yaml
kubectl get secret -n litellm -o yaml >> secrets-backup.yaml
```

---

## ğŸš¨ ì¥ì•  ëŒ€ì‘

### ê¸´ê¸‰ ìƒí™© ëŒ€ì‘ ì ˆì°¨

#### 1ë‹¨ê³„: ìƒí™© íŒŒì•… (5ë¶„ ì´ë‚´)
```bash
# ì „ì²´ ìƒíƒœ ë¹ ë¥¸ í™•ì¸
kubectl get pods -A | grep -v Running
kubectl get nodes
kubectl top nodes

# ìµœê·¼ ì´ë²¤íŠ¸ í™•ì¸
kubectl get events -A --sort-by='.lastTimestamp' | tail -20
```

#### 2ë‹¨ê³„: ì„ì‹œ ì¡°ì¹˜ (10ë¶„ ì´ë‚´)
```bash
# íŒŒë“œ ì¬ì‹œì‘
kubectl rollout restart deployment/openwebui -n openwebui

# íŠ¸ë˜í”½ ì°¨ë‹¨ (í•„ìš”ì‹œ)
kubectl patch ingress openwebui-ingress -n openwebui -p \
  '{"metadata":{"annotations":{"nginx.ingress.kubernetes.io/server-snippet":"return 503;"}}}'

# ìŠ¤ì¼€ì¼ ë‹¤ìš´ (ë¦¬ì†ŒìŠ¤ ë¶€ì¡± ì‹œ)
kubectl scale deployment openwebui --replicas=1 -n openwebui
```

#### 3ë‹¨ê³„: ê·¼ë³¸ ì›ì¸ ë¶„ì„
```bash
# ìƒì„¸ ë¡œê·¸ ë¶„ì„
kubectl logs deployment/openwebui -n openwebui --previous
kubectl describe pod -l app=openwebui -n openwebui

# ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ ë¶„ì„
kubectl top pods -n openwebui --containers
kubectl describe nodes
```

### ì¼ë°˜ì ì¸ ì¥ì•  ì‹œë‚˜ë¦¬ì˜¤

#### íŒŒë“œê°€ ì‹œì‘ë˜ì§€ ì•ŠëŠ” ê²½ìš°
```bash
# ì›ì¸ í™•ì¸
kubectl describe pod <pod-name> -n openwebui

# ì¼ë°˜ì ì¸ í•´ê²°ì±…
# 1. ì´ë¯¸ì§€ ë¬¸ì œ
kubectl get pods -n openwebui -o jsonpath='{.items[*].spec.containers[*].image}'

# 2. ë¦¬ì†ŒìŠ¤ ë¶€ì¡±
kubectl describe nodes | grep -A 5 "Allocated resources"

# 3. PVC ë§ˆìš´íŠ¸ ì‹¤íŒ¨
kubectl get pvc -n openwebui
kubectl describe pvc <pvc-name> -n openwebui
```

#### ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨
```bash
# PostgreSQL ìƒíƒœ í™•ì¸
kubectl get pods -l app=postgres -n openwebui
kubectl logs deployment/postgres -n openwebui

# ì—°ê²° í…ŒìŠ¤íŠ¸
kubectl exec deployment/postgres -n openwebui -- pg_isready

# ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™•ì¸
kubectl exec deployment/openwebui -n openwebui -- \
  nc -zv postgres-service 5432
```

#### ë†’ì€ ì‘ë‹µ ì‹œê°„
```bash
# ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ í™•ì¸
kubectl top pods -n openwebui

# HPA ìŠ¤ì¼€ì¼ë§ ê°•ì œ ì‹¤í–‰
kubectl patch hpa openwebui-hpa -n openwebui -p \
  '{"spec":{"minReplicas":3}}'

# ìºì‹œ í´ë¦¬ì–´ (ì• í”Œë¦¬ì¼€ì´ì…˜ë³„ ë°©ë²•)
kubectl exec deployment/openwebui -n openwebui -- \
  curl -X POST http://localhost:8080/api/v1/cache/clear
```

---

## ğŸ”§ ìœ ì§€ë³´ìˆ˜

### ì •ê¸° ì—…ë°ì´íŠ¸
```bash
#!/bin/bash
# update-system.sh

echo "ğŸ”„ ì‹œìŠ¤í…œ ì—…ë°ì´íŠ¸ ì‹œì‘..."

# 1. EKS í´ëŸ¬ìŠ¤í„° ì—…ë°ì´íŠ¸ í™•ì¸
aws eks describe-cluster --name openwebui-eks-dev \
  --query 'cluster.version' --output text

# 2. ë…¸ë“œ ê·¸ë£¹ ì—…ë°ì´íŠ¸ í™•ì¸
aws eks describe-nodegroup --cluster-name openwebui-eks-dev \
  --nodegroup-name primary-nodes \
  --query 'nodegroup.version' --output text

# 3. Add-on ì—…ë°ì´íŠ¸
kubectl get pods -n kube-system

# 4. ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸
kubectl set image deployment/openwebui openwebui=ghcr.io/openwebui:latest -n openwebui

echo "âœ… ì—…ë°ì´íŠ¸ ì™„ë£Œ"
```

### ë³´ì•ˆ íŒ¨ì¹˜
```bash
# ë³´ì•ˆ ìŠ¤ìº” ì‹¤í–‰
trivy image ghcr.io/openwebui:latest

# ì·¨ì•½ì  ìˆëŠ” ì»¨í…Œì´ë„ˆ ì¬ë°°í¬
kubectl rollout restart deployment/openwebui -n openwebui

# ì‹œí¬ë¦¿ ë¡œí…Œì´ì…˜
kubectl create secret generic api-keys \
  --from-literal=OPENAI_API_KEY=new-key \
  --dry-run=client -o yaml | kubectl apply -f -
```

### ìš©ëŸ‰ ê´€ë¦¬
```bash
# ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§
kubectl get pvc -A -o custom-columns=NAME:.metadata.name,SIZE:.spec.resources.requests.storage,USED:.status.capacity.storage

# ë¡œê·¸ ì •ë¦¬
kubectl logs deployment/openwebui -n openwebui --tail=1000 > /dev/null

# ì´ë¯¸ì§€ ì •ë¦¬ (ë…¸ë“œì—ì„œ ì§ì ‘)
docker system prune -a
```

---

## ğŸ“ˆ ì„±ëŠ¥ íŠœë‹

### ì• í”Œë¦¬ì¼€ì´ì…˜ ìµœì í™”
```yaml
# OpenWebUI ì„±ëŠ¥ ì„¤ì •
env:
- name: WEBUI_SECRET_KEY
  value: "optimized-secret-key"
- name: MAX_WORKERS
  value: "4"
- name: TIMEOUT
  value: "60"
- name: KEEP_ALIVE
  value: "2"
```

### ë°ì´í„°ë² ì´ìŠ¤ íŠœë‹
```sql
-- PostgreSQL ì„±ëŠ¥ íŠœë‹
-- ì—°ê²° í’€ ì„¤ì •
ALTER SYSTEM SET max_connections = 100;
ALTER SYSTEM SET shared_buffers = '256MB';
ALTER SYSTEM SET effective_cache_size = '1GB';
ALTER SYSTEM SET work_mem = '4MB';

-- ì¸ë±ìŠ¤ í™•ì¸ ë° ìµœì í™”
SELECT schemaname, tablename, attname, n_distinct, correlation 
FROM pg_stats WHERE tablename = 'your_table';
```

### ë„¤íŠ¸ì›Œí¬ ìµœì í™”
```yaml
# Ingress ì„¤ì • ìµœì í™”
annotations:
  nginx.ingress.kubernetes.io/proxy-connect-timeout: "60"
  nginx.ingress.kubernetes.io/proxy-send-timeout: "60"
  nginx.ingress.kubernetes.io/proxy-read-timeout: "60"
  nginx.ingress.kubernetes.io/proxy-body-size: "50m"
  nginx.ingress.kubernetes.io/enable-cors: "true"
```

---

## ğŸ’° ë¹„ìš© ìµœì í™”

### ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ ë¶„ì„
```bash
# ë…¸ë“œ ë¹„ìš© ë¶„ì„
kubectl describe nodes | grep -A 3 "Allocated resources"

# Spot ì¸ìŠ¤í„´ìŠ¤ í™œìš©ë¥ 
kubectl get nodes -l node.kubernetes.io/instance-type

# ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ë¦¬ì†ŒìŠ¤ ì •ë¦¬
kubectl get pods -A --field-selector=status.phase=Succeeded
kubectl delete pods --field-selector=status.phase=Succeeded -A
```

### ìë™ ìŠ¤ì¼€ì¼ë§ ìµœì í™”
```yaml
# ë¹„ìš© íš¨ìœ¨ì ì¸ HPA ì„¤ì •
spec:
  minReplicas: 1        # ìµœì†Œ ë¹„ìš©
  maxReplicas: 10       # íŠ¸ë˜í”½ ëŒ€ì‘
  targetCPUUtilizationPercentage: 70  # ì ì ˆí•œ í™œìš©ë¥ 
  
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 300  # ê¸‰ê²©í•œ ìŠ¤ì¼€ì¼ ë‹¤ìš´ ë°©ì§€
      policies:
      - type: Percent
        value: 50
        periodSeconds: 60
```

---

## ğŸ“ ë¹„ìƒ ì—°ë½ ì²´ê³„

### ì¥ì•  ë“±ê¸‰ë³„ ëŒ€ì‘
```yaml
P0 (Critical): 
  - ì„œë¹„ìŠ¤ ì™„ì „ ì¤‘ë‹¨
  - ì¦‰ì‹œ ëŒ€ì‘ (24/7)
  - ì—°ë½ì²˜: [ê¸´ê¸‰ ì—°ë½ì²˜]

P1 (High):
  - ì£¼ìš” ê¸°ëŠ¥ ì¥ì• 
  - 4ì‹œê°„ ì´ë‚´ ëŒ€ì‘
  - ì—°ë½ì²˜: [íŒ€ ë¦¬ë”]

P2 (Medium):
  - ë¶€ë¶„ ê¸°ëŠ¥ ì¥ì•   
  - 24ì‹œê°„ ì´ë‚´ ëŒ€ì‘
  - ì—°ë½ì²˜: [ë‹´ë‹¹ì]

P3 (Low):
  - ì„±ëŠ¥ ì €í•˜
  - 72ì‹œê°„ ì´ë‚´ ëŒ€ì‘
  - ì—°ë½ì²˜: [íŒ€ ë©”ì¼]
```

### ì—ìŠ¤ì»¬ë ˆì´ì…˜ ì ˆì°¨
1. 1ì°¨ ë‹´ë‹¹ì (30ë¶„ ì´ë‚´ ì‘ë‹µ)
2. íŒ€ ë¦¬ë” (1ì‹œê°„ ì´ë‚´)  
3. ê¸°ìˆ  ì±…ì„ì (2ì‹œê°„ ì´ë‚´)
4. CTO (4ì‹œê°„ ì´ë‚´)

---

## ğŸ“š ìš´ì˜ ë„êµ¬ ë° ëŒ€ì‹œë³´ë“œ

### í•„ìˆ˜ ë„êµ¬
```bash
# kubectl í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜
kubectl krew install ctx ns stern top

# ìœ ìš©í•œ ëª…ë ¹ì–´ ë³„ì¹­
alias k='kubectl'
alias kgp='kubectl get pods'
alias kgs='kubectl get svc' 
alias kgn='kubectl get nodes'
alias kdp='kubectl describe pod'
alias kl='kubectl logs'
```

### ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ
- **Grafana**: `http://grafana.your-domain.com`
- **Prometheus**: `http://prometheus.your-domain.com`
- **Jaeger**: `http://jaeger.your-domain.com` (íŠ¸ë ˆì´ì‹±)
- **ArgoCD**: `http://argocd.your-domain.com` (GitOps)

### ë¡œê·¸ ë¶„ì„
```bash
# ì¤‘ì•™í™”ëœ ë¡œê¹… (ELK Stack)
kubectl port-forward svc/kibana 5601:5601 -n logging

# ë¡œê·¸ ì¿¼ë¦¬ ì˜ˆì‹œ
# Kibanaì—ì„œ: kubernetes.namespace:"openwebui" AND level:"ERROR"
```

---

## ğŸ”„ ì •ê¸° ì‘ì—… ìŠ¤ì¼€ì¤„

### ì¼ì¼ ì‘ì—… (ìë™í™”)
```yaml
# CronJob ì˜ˆì‹œ
apiVersion: batch/v1
kind: CronJob
metadata:
  name: daily-cleanup
spec:
  schedule: "0 2 * * *"  # ë§¤ì¼ ì˜¤ì „ 2ì‹œ
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - name: cleanup
            image: alpine:latest
            command:
            - /bin/sh
            - -c
            - |
              # ë¡œê·¸ ì •ë¦¬
              find /var/log -name "*.log" -mtime +7 -delete
              # ì„ì‹œ íŒŒì¼ ì •ë¦¬
              find /tmp -mtime +1 -delete
          restartPolicy: OnFailure
```

### ì£¼ê°„ ì‘ì—…
- ë°±ì—… ê²€ì¦ í…ŒìŠ¤íŠ¸
- ë³´ì•ˆ ìŠ¤ìº” ì‹¤í–‰
- ì„±ëŠ¥ ë¦¬í¬íŠ¸ ì‘ì„±
- ë¹„ìš© ë¶„ì„ ë¦¬í¬íŠ¸

### ì›”ê°„ ì‘ì—…  
- DR(ì¬í•´ë³µêµ¬) í…ŒìŠ¤íŠ¸
- ë³´ì•ˆ ê°ì‚¬
- ìš©ëŸ‰ ê³„íš ê²€í† 
- ì•„í‚¤í…ì²˜ ë¦¬ë·°

ì´ì œ ì™„ì „í•œ ìš´ì˜ ë§¤ë‰´ì–¼ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ› ï¸